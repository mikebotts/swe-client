<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. 
   -
   - Software distributed under the License is distributed on an "AS IS" basis,
   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   - for the specific language governing rights and limitations under the License.
   -
   - The Initial Developer is Terravolv, Inc. Portions created by the Initial
   - Developer are Copyright (C) 2014-2015 the Initial Developer. All Rights Reserved. -->
<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="author" content="Open Sensor Hub" />
  <title>Open Sensor Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="resource" type="application/l10n" href="locales/locales.ini" />
  <script src="js/l10n.js"></script>
  <link href="assets/css/bootstrap.min.css" rel="stylesheet">
  <link type="text/css" href="css/custom-theme/jquery-ui-1.10.0.custom.css" rel="stylesheet" />
  <link type="text/css" href="assets/css/font-awesome.min.css" rel="stylesheet" />
  <link href="assets/css/docs.css" rel="stylesheet">
  <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">

  <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
  <!--  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script> -->

  <script src="js/sQuery.js"></script>
  <script src="js/sQueryGetLocationDescriptor.js"></script>
  <script src="js/main.js"></script>
 
</head>
<body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true">
  <!-- Navbar -->
  <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
          <div class="container">
              <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </button>
              <a class="brand" href="https://github.com/mikebotts/swe-client/tree/master/OpenSensorHubClientLibrary">Open SensorHub Client Library</a>
              <div class="nav-collapse collapse">
                  <ul class="nav">
                      <li class="active">
                          <a href="./index.html">Home</a>
                      </li>
                      <li>
                          <a href="./capabilities.html">Review SOS Server Capabilities</a>
                      </li>
                      <li>
                          <a href="https://github.com/mikebotts/swe-client">Feedback/Issues</a>
                      </li>
                      <li>
                          <a href="https://github.com/mikebotts">Contact</a>
                      </li>
                  </ul>
              </div>
          </div>
      </div>
  </div>
  <!-- Subhead -->
  <header class="jumbotron subhead" id="overview">
      <div class="container">
          <h1>Open SensorHub Client Library</h1>
          <p class="lead">A kickstart for SOS Javascript Client.</p>
      </div>
  </header>
  <div class="container">
    <div class="row">
        <div class="span3 bs-docs-sidebar">
            <ul class="nav nav-list bs-docs-sidenav">
                <li><a href="#overview"><i class="icon-chevron-right"></i> Overview</a></li>
                <li><a href="#capabilities"><i class="icon-chevron-right"></i> Capabilities</a></li>
                <li><a href="#resulttemplates"><i class="icon-chevron-right"></i> Result Templates</a></li>
                <li><a href="#results"><i class="icon-chevron-right"></i> Results</a></li>
            </ul>
        </div>
        <div class="span9">
          <!-- Overview -->
          <section id="overview">
              <div class="page-header">
                  <h1>1. Overview</h1>
              </div>
              <div class="row-fluid">
                  <p class="docs-lead">
                    Welcome! Here you will find information about how to use JavaScript to communicate with the SOS/SensorHub server.  
                    First, to communicate with the server you just need to know the base URL of the SOS server.
                  </p>
                  <p>
                   <label for="oshServers">For example:</label><br/>
                   <select class="baseurl">
                     <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                     <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                   </select>
                  </p>
              </div>
          </section>
          <!-- Capabilities -->
          <section id="capabilities">
              <div class="page-header">
                  <h1>2. Capabilities</h1>
              </div>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Second, using the base URL of the SOS server, you must first determine the capabilities of the server.  This can be done using the 
                  Open SensorHub client library (sQuery.js).  This library is modelled after jQuery and is therefore very easy to comprehend and utilize. 
                  Much like jQuery is aliased to "$", sQuery is aliased to "S" and can be referenced using it's alias.  To get the capabilities of a 
                  SOS server you simply call it's getcapabilities method by passing in the base URL to sQuery, and a callback method that accepts the 
                  returned capabilities.  The capabilities are returned as XML.  But first let's see how to call getCapabilities.
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must reference sQuery.js in order to use it.
              </div>              
              <p>
                  <a class="download-btn ui-button-primary" href="https://github.com/mikebotts/swe-client/tree/master/OpenSensorHubClientLibrary">Download sQuery.js</a>
              </p>
              <p>
              <h2>sQuery.getCapabilitiesURL</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Before we review how to call getCapabilities, let us see the fully qualified URL that this method issues to retrieve the 
                  capabilities of the selected SOS server.  This can be done using the sQuery.getcapabilitiesurl method.  You may cut & paste the 
                  provided URL in the browser's address bar to review the XML document returned by the SOS server.
                  </p>
              </div>              
              <div id="gcTabs">
                <ul>
                    <li><a href="#gcTabs-Demo">Demo</a></li>
                    <li><a href="#gcTabs-Code">Code</a></li>
                </ul>
                <div id="gcTabs-Demo">
                  <p class="docs-lead">
                    <select id = "gcServers" class="baseurl">
                     <option value = "">Select a SOS Server</option>
                     <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                     <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                    </select>
                  </p>
                  <p class="docs-lead">
                    <label for="gcURL">Capabilities URL: </label>
                    <input type="text" id="gcURL" class="capabilitiesurl">
                  </p>
                </div>
                <div id="gcTabs-Code">
<pre class="prettyprint linenums">     
$( "#gcServers").change(function() {
  if (this.value === "")  {
    $("#gcURL").val("");
  } else {
   try {
     $("#gcURL").val(S(this.value).getcapabilitiesurl());
   } catch (e) {
     alert(e);
   }
  }
});         
</pre>
                </div>
            </div>
          <h2>sQuery.getCapabilities</h2>
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
 S(alexsServer).getcapabilities(function(c) {
  try {
    // Do something with the returned capabilities (c)
  } catch (e) {
    console.log(e);
  }
 });
} catch (e) {
 alert(e);
}</pre>
              <h2>Contents of the capabilities XML</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                    The capabilities XML contains four elements.
                    <ul>
                      <li>Service Indentification</li>
                      <li>Service Provider Information</li>
                      <li>Operations Metadata </li>
                      <li>Offerings Information</li>
                    </ul>
                  </p>
              </div>
              <h2>sQuery.getserviceidentification</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  You can call the getserviceidentification method to retrieve the service indentification information from the returned capabilities.
                  This method returns an Object that contains six properties.
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must call sQuery.getCapabilities before calling sQuery.getserviceidentification.
              </div>              
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
 S(alexsServer).getcapabilities(function(c) {
  try {
    var $si = S().getserviceidentification(c)
    var title = $si.title;  // string
    var abstract = $si.abstract; // string
    var type = $si.type; // string 
    var fees = $si.fees; // string 
    var accesscontraints = $si.accessconstraints; // string
    var profiles = $si.profiles; // string[]
  } catch (e) {
    console.log(e);
  }
 });
} catch (e) {
 alert(e);
}</pre>
          <h2>Let's see sQuery.getserviceidentification In Action</h2>
          <div id="siTabs">
              <ul>
                  <li><a href="#siTabs-Demo">Demo</a></li>
                  <li><a href="#siTabs-Code">Code</a></li>
              </ul>
              <div id="siTabs-Demo">
                <p class="docs-lead">
                  <select id = "siServers" class="baseurl">
                   <option value = "">Select a SOS Server</option>
                   <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                   <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                  </select>
                </p>
                <p class="docs-lead">
                  <label for="siTitle">Title: </label>
                  <input type="text" id="siTitle" class="serviceident">
                  <label for="siAbstract">Abstract: </label>
                  <input type="text" id="siAbstract" class="serviceident">
                  <label for="siType">Type: </label>
                  <input type="text" id="siType" class="serviceident">
                  <label for="siFees">Fees: </label>
                  <input type="text" id="siFees" class="serviceident">
                  <label for="siAC">Access Constraints: </label>
                  <input type="text" id="siAC" class="serviceident">
                  <label for="siProfiles">Profiles: </label>
                  <select id="siProfiles" class="serviceident"></select>
                </p>
              </div>
              <div id="siTabs-Code">
<pre class="prettyprint linenums">              
$( "#oshServers").change(function() {
  if (this.value === "")  {
    $("#siTitle").val("");
    $("#siAbstract").val("");
    $("#siType").val("");
    $("#siFees").val("");
    $("#siAC").val("");
    $("#siProfiles").empty()
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      try {
        var $si = S().getserviceidentification(c);
        console.log($si);
        $("#siTitle").val($si.title);
        $("#siAbstract").val($si.abstract);
        $("#siType").val($si.type);
        $("#siFees").val($si.fees);
        $("#siAC").val($si.accessconstraints);
        $("#siProfiles").empty()
        $.each($si.profiles, function( index, value ) {
          $("#siProfiles").append("&lt;option value='" + value + "'&gt;" + value + "&lt;/option&gt;");
        });
        
      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});</pre>
              </div>
          </div>
          
              <h2>sQuery.getserviceprovider</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  This method returns the SOS service provider details.  The method requires the capabilities XML as input and returns an 
                  Object that contains four properties.
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must call sQuery.getCapabilities before calling sQuery.getserviceprovider.
              </div>              
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
 S(alexsServer).getcapabilities(function(c) {
  try {
    var $sp = S().getserviceprovider(c)
    var name = $sp.name;  // string
    var contactname = $sp.contactname; // string
    var contactposition = $sp.contactposition; // string 
    var contactaddress = $sp.contactaddress; // string 
  } catch (e) {
    console.log(e);
  }
 });
} catch (e) {
 alert(e);
}</pre>
          <h2>sQuery.getserviceprovider In Action</h2>
          <div id="spTabs">
              <ul>
                  <li><a href="#spTabs-Demo">Demo</a></li>
                  <li><a href="#spTabs-Code">Code</a></li>
              </ul>
              <div id="spTabs-Demo">
                <p class="docs-lead">
                  <select id = "spServers" class="baseurl">
                   <option value = "">Select a SOS Server</option>
                   <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                   <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                  </select>
                </p>
                <p class="docs-lead">
                  <label for="spName">Name: </label>
                  <input type="text" id="spName" class="serviceident">
                  <label for="spContactName">Contact Name: </label>
                  <input type="text" id="spContactName" class="serviceident">
                  <label for="spContactPosition">Contact Position: </label>
                  <input type="text" id="spContactPosition" class="serviceident">
                  <label for="spContactAddress">Contact Address: </label>
                  <input type="text" id="spContactAddress" class="serviceident">
                </p>
              </div>
              <div id="spTabs-Code">
<pre class="prettyprint linenums">              
$( "#spServers").change(function() {
  if (this.value === "")  {
    $("#spName").val("");
    $("#spContactName").val("");
    $("#spContactPosition").val("");
    $("#spContactAddress").val("");
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      try {
        var $sp = S().getserviceprovider(c);
        $("#spName").val($sp.name);
        $("#spContactName").val($sp.contactname);
        $("#spContactPosition").val($sp.contactposition);
        $("#spContactAddress").val($sp.contactaddress);        
      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});</pre>
              </div>
          </div>

              <h2>sQuery.getoperationsmetadata</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Use this method retrieve the operations metadata of the SOS server.  It returns an Array of Objects, each of
                  which contain three properties.  The capabilities XML document must be provided as input to this method.
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must call sQuery.getCapabilities before calling sQuery.getoperationsmetadata.
              </div>              
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
 S(alexsServer).getcapabilities(function(c) {
  try {
    var $om = S().getoperationsmetadata(c)
    // Do something with the metadata returned
  } catch (e) {
    console.log(e);
  }
 });
} catch (e) {
 alert(e);
}</pre>
          <h2>sQuery.getoperationsmetadata In Action</h2>
          <div id="omTabs">
              <ul>
                  <li><a href="#omTabs-Demo">Demo</a></li>
                  <li><a href="#omTabs-Code">Code</a></li>
              </ul>
              <div id="omTabs-Demo">
                <p class="docs-lead">
                  <select id = "omServers" class="baseurl">
                   <option value = "">Select a SOS Server</option>
                   <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                   <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                  </select>
                </p>
                <p class="docs-lead">
                  <label for="omOperations">Operations: </label>
                  <select id="omOperations" class="serviceident"></select>
                  <label for="omOperationsPost">Post URL: </label>
                  <input type="text" id="omOperationsPost" class="serviceident">
                  <label for="omOperationsGet">Get URL: </label>
                  <input type="text" id="omOperationsGet" class="serviceident">
                </p>
              </div>
              <div id="omTabs-Code">
<pre class="prettyprint linenums">              
$( "#omServers").change(function() {
  if (this.value === "")  {
    $("#omOperations").empty();
    $("#omOperationsPost").val("");
    $("#omOperationsGet").val("");
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      try {
        var $om = S().getoperationsmetadata(c);
        $("#omOperations").empty();
        $("#omOperationsPost").val("");
        $("#omOperationsGet").val("");          
        $("#omOperations").append("&lt;option value=''&gt;Select an Operation&lt;/option&gt;");
        $.each($om, function( index, operation) {
          $("#omOperations").append("&lt;option value='" + operation.name + "|" + operation.postbaseurl + "|" + operation.getbaseurl + "'&gt;" + operation.name + "&lt;/option&gt;");
        });    
      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});

$( "#omOperations").change(function() {
  if (this.value === "")  {
    $("#omOperationsPost").val("");
    $("#omOperationsGet").val("");
  } else {
   try {
    var vals = this.value.trim().split("|");
    $("#omOperationsPost").val(vals[1]);
    $("#omOperationsGet").val(vals[2]);
   } catch (e) {
     alert(e);
   }
  }
});</pre>
              </div>
          </div>

              <h2>sQuery.getofferings</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Thus far we have reviewed how to access SOS server capabilities, which includes service identification, 
                  provider information and operations metadata.  The last, and one of the most important, elements of the SOS 
                  server capabilities, is it's offerings.
                  </p>
                  <p class="docs-lead">
                  Offerings tell us about what the observables that a SOS server is hosting. In the SOS, observations are grouped 
                  into layers per each sensor system. These layers are called ObservationOffering (or short: offering). 
                  A sensor system can be a simple thermometer, but can also consist of several sensors or even sub-(sensor)systems. 
                  For example, a valid sensor system can be a system of sensors attached to a weather station, or it can be 
                  a network of spatially distributed sensors.  
                  </p>
                  <p class="docs-lead">
                  You may use the getofferings method of the client library to review the offerings of a given SOS server.  Much like
                  it's siblings, this method requires the capabilities XML as an input from which to extract the offerings.  It returns 
                  an Array of offerings.  Each offering within the returned Array contains six attributes of the offering.  Certain 
                  attributes are themselves returned as nested Arrays due to one-to-many relationships between the offering and such
                  attributes.
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must call sQuery.getCapabilities before calling sQuery.getofferings.
              </div>              
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
 S(alexsServer).getcapabilities(function(c) {
  try {
    var $off = S().getofferings(c)  // Returns Array of Offerings
    // Do something with the metadata returned
  } catch (e) {
    console.log(e);
  }
 });
} catch (e) {
 alert(e);
}</pre>
          <h2>sQuery.getofferings In Action</h2>
          <div id="offTabs">
              <ul>
                  <li><a href="#offTabs-Demo">Demo</a></li>
                  <li><a href="#offTabs-Code">Code</a></li>
              </ul>
              <div id="offTabs-Demo">
                <p class="docs-lead">
                  <select id = "offServers" class="baseurl">
                   <option value = "">Select a SOS Server</option>
                   <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                   <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                  </select>
                </p>
                <p class="docs-lead">
                  <label for="offerings">Offerings: </label>
                  <select id="offerings" class="serviceident"></select>
                  <label for="offIdentifier">Identifier: </label>
                  <input type="text" id="offIdentifier" class="serviceident">
                  <label for="offDescription">Description: </label>
                  <input type="text" id="offDescription" class="serviceident">
                  <label for="offProcedure">Procedure: </label>
                  <input type="text" id="offProcedure" class="serviceident">
                  <label for="offObservables">Observables: </label>
                  <select id="offObservables" class="serviceident"></select>
                  <label for="offPhenonmenonTime">Phenomenon Time: </label>
                  <select id="offPhenonmenonTime" class="serviceident"></select>          
                  <label for="offPhenonmenonTimeBegin">Begin Time: </label>
                  <input type="text" id="offPhenonmenonTimeBegin" class="serviceident">
                  <label for="offPhenomenonIndeterminateTime">Indeterminate Time: </label>
                  <input type="text" id="offPhenomenonIndeterminateTime" class="serviceident">
                  <label for="offPhenomenonEndBegin">End Time: </label>
                  <input type="text" id="offPhenomenonEndBegin" class="serviceident">
                </p>
              </div>
              <div id="offTabs-Code">
<pre class="prettyprint linenums">              
$( "#offServers").change(function() {
  if (this.value === "")  {
    $("#offIdentifier").val("");
    $("#offDescription").val("");
    $("#offProcedure").val("");
    $("#offerings").empty();
    $("#offObservables").empty();
    $("#offPhenonmenonTime").empty();
    $("#offPhenonmenonTimeBegin").val("");
    $("#offPhenomenonIndeterminateTime").val("");
    $("#offPhenomenonEndBegin").val("");
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      try {
        $offerings = S().getofferings(c);
        $("#offerings").empty();
        $("#offIdentifier").val("");
        $("#offDescription").val("");
        $("#offProcedure").val("");
        $("#offObservables").empty();
        $("#offPhenonmenonTime").empty();
        $("#offPhenonmenonTimeBegin").val("");
        $("#offPhenomenonIndeterminateTime").val("");
        $("#offPhenomenonEndBegin").val("");
  
        $("#offerings").append("<option value=''>Select an Offering</option>");
        $.each($offerings, function( index, offering) {
          $("#offerings").append("<option value='" + index + "'>" + offering.name + "</option>");
        });    
      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});

  $( "#offerings").change(function() {
    if (this.value === "")  {
      $("#offName").val();
      $("#offIdentifier").val("");
      $("#offDescription").val("");
      $("#offProcedure").val("");
      $("#offObservables").empty();
      $("#offPhenonmenonTime").empty();
      $("#offPhenonmenonTimeBegin").val("");
      $("#offPhenomenonIndeterminateTime").val("");
      $("#offPhenomenonEndBegin").val("");
    } else {
      try {
        $("#offIdentifier").val($offerings[parseInt(this.value)].identifier);
        $("#offDescription").val($offerings[parseInt(this.value)].description);
        $("#offProcedure").val($offerings[parseInt(this.value)].procedure);
        $("#offObservables").empty();
        $.each($offerings[parseInt(this.value)].observableproperties, function( index, observableproperty) {
          $("#offObservables").append("<option value='" + index + "'>" + observableproperty + "</option>");
        });
        $("#offPhenonmenonTime").empty();
        $("#offPhenonmenonTimeBegin").val("");
        $("#offPhenomenonIndeterminateTime").val("");
        $("#offPhenomenonEndBegin").val("");        
        $("#offPhenonmenonTime").append("<option value=''>Select a Time</option>");
        $.each($offerings[parseInt(this.value)].phenomenontime, function( index, pTime) {
          $("#offPhenonmenonTime").append("<option value='" + index + "'>" + pTime.identifier + "</option>");
        });      
     } catch (e) {
       alert(e);
     }
    }
  });
  
  $( "#offPhenonmenonTime").change(function() {
    if (this.value === "")  {
      $("#offPhenonmenonTimeBegin").val("");
      $("#offPhenomenonIndeterminateTime").val("");
      $("#offPhenomenonEndBegin").val("");
    } else {
     try {
      $("#offPhenonmenonTimeBegin").val($offerings[parseInt($("#offerings").val())].phenomenontime[parseInt(this.value)].begin);
      $("#offPhenomenonIndeterminateTime").val($offerings[parseInt($("#offerings").val())].phenomenontime[parseInt(this.value)].indeterminatePosition);
      $("#offPhenomenonEndBegin").val($offerings[parseInt($("#offerings").val())].phenomenontime[parseInt(this.value)].end);  
     } catch (e) {
       alert(e);
     }
    }
  });</pre>
              </div>
          </div>
          
          
        </section>

          <!-- Result Template -->
          <section id="resulttemplates">
              <div class="page-header">
                  <h1>3. Result Templates</h1>
              </div>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Now that we have the SOS server's capabilities, we need to determine how to consume the data served from the server.  
                  To do so, we must understand the format of the incoming data.  This is done using the SOS result template.  The template
                  describes the format of the data that will be served by the SOS server. So, how do we do this?
                  </p>
                  <p class="docs-lead">
                  The SOS server supports a GET request to return the description of the data that will be served for a particular 
                  observable.  What is implied is that the description of each observable will be different.  To fetch that data record 
                  description (format of the incoming data) we need to construct the proper GET request.  This is handled by the sQuery
                  library's getresulttemplateurl method.  
                  </p>
              </div>
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must reference sQuery.js in order to use it.
              </div>              
              <p>
              <h2>sQuery.getresulttemplateurl</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  The sQUery.getresulttemplateurl method accepts two parameters, the offering identifier and the observed property, and 
                  returns the fully qualified URL to fetch the data record description in XML format.  
                  
                  The offering identifier and observed property list are returned by the sQuery getofferings method as described the previous
                  section.  Let's see how the fully qualified URL looks to get the result template.  You may cut & paste the 
                  provided URL in the browser's address bar to review the XML document (template) returned by the SOS server.
                  </p>
              </div>              
              <div class="alert alert-info">
                  <span class="icon-info-sign"></span> You must pass in the base SOS URL when calling sQuery.getresulttemplateurl.
              </div>              
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try {
  var resultTemplateURL = S(mikesServer).getresulttemplateurl('urn:android:device:FA44CWM03715-sos', 'http://sensorml.com/ont/swe/property/Location');
  console.log(resultTemplateURL);
} catch (e) {
 alert(e);
}</pre>
          <h2>sQuery.getresulttemplateurl In Action</h2>
          <div class="row-fluid">
              <p class="docs-lead">
              Select an identifier and an observable, and click the Get Result Template URL button.
              </p>
          </div>
          <button id="btnGetTemplateURL" class="ui-button-primary">Get Result Template URL</button>
          
         <div id="grturlTabs">
              <ul>
                  <li><a href="#grturlTabs-Demo">Demo</a></li>
                  <li><a href="#grturlTabs-Code">Code</a></li>
              </ul>
              <div id="grturlTabs-Demo">
                <p class="docs-lead">
                  <select id = "grturloffServers" class="baseurl">
                   <option value = "">Select a SOS Server</option>
                   <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                   <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                  </select>
                </p>
                <p class="docs-lead">
                  <label for="grturlofferings">Offerings: </label>
                  <select id="grturlofferings" class="serviceident"></select>
                  <label for="grturloffIdentifier">Identifier: </label>
                  <input type="text" id="grturloffIdentifier" class="serviceident">
                  <label for="grturloffObservables">Observables: </label>
                  <select id="grturloffObservables" class="serviceident"></select>
                  <label for="grturlURL">Result Template URL: </label>
                  <input type="text" id="grturlURL" class="serviceident">
                </p>
              </div>
              <div id="grturlTabs-Code">
<pre class="prettyprint linenums">
$( "#grturloffServers").change(function() {
  if (this.value === "")  {
    $("#grturloffIdentifier").val("");
    $("#grturlofferings").empty();
    $("#grturloffObservables").empty();
    $("#grturlURL").val("");
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      console.log("Got a " + Object.prototype.toString.call(c).slice(8, -1));
      console.log(c);
      try {
        $grturlofferings = S().getofferings(c);
        console.log($offerings);
        $("#grturlofferings").empty();
        $("#grturloffIdentifier").val("");
        $("#grturloffObservables").empty();
        $("#grturlURL").val("");

        $("#grturlofferings").append("<option value=''>Select an Offering</option>");
        $.each($grturlofferings, function( index, offering) {
          $("#grturlofferings").append("<option value='" + index + "'>" + offering.name + "</option>");
        });    

      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});

$( "#grturlofferings").change(function() {
  if (this.value === "")  {
    $("#grturloffIdentifier").val("");
    $("#grturloffObservables").empty();
    $("#grturlURL").val("");
  } else {
    try {
      $("#grturloffIdentifier").val($grturlofferings[parseInt(this.value)].identifier);
      $("#grturloffObservables").empty();
      $("#grturlURL").val("");
      $.each($grturlofferings[parseInt(this.value)].observableproperties, function( index, observableproperty) {
        $("#grturloffObservables").append("<option value='" + index + "'>" + observableproperty + "</option>");
      });
   } catch (e) {
     alert(e);
   }
  }
});

$( "#btnGetTemplateURL").click(function(){
  if (undefined === $("#grturloffIdentifier").val().trim() || !$("#grturloffIdentifier").val().trim()) {
    alert("Identifier must be set.");
    return;
  }
  var url = S($("#grturloffServers option:selected").val())
            .getresulttemplateurl($("#grturloffIdentifier").val(), 
                                  $("#grturloffObservables option:selected").text());
  $("#grturlURL").val(url);

});</pre>
              </div>
          </div>

          <h2>Getting Result Templates</h2>

          <div class="row-fluid">
              <p class="docs-lead">
              So, now that we know what the template URL is, how to we use it?. The current implementation of sQuery requires that 
              specific plug-ins, one per template URL, be used to fetch the template URL contents. 
              </p>
          </div>
          <div class="ui-widget">
            <div class="ui-state-error ui-corner-all">
              <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span>
                <strong>Alert:</strong> One plug-in per template architecture is still under development and is subject to change in the future.
              </p>
            </div>
          </div>          
          <div class="row-fluid">
              <p class="docs-lead">
                Let's see below how template contents are retrieved from the SOS server given the present architecture.
              </p>
          </div>
          <div class="row-fluid">
              <p class="docs-lead">
              For this exercise we will access the location template from a fake GPS SOS server that serves GPS data for a moving
              target.  This template is accessible by calling the sQuery.getlocationdescriptor method.  This method is actually implemented
              as a sQuery extension/plug-in, which is similar to the jQuery plug-ins. 
              </p>
          </div>
<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try { 
  var url = S(mikesServer).getresulttemplateurl('&lt;identifier&gt;', '&lt;observed property&gt;');
  S().getlocationdescriptor(url, function(t) {
    // Do something with the returned location template!
  });
} catch (e) {
  console.log(e);
}</pre>
              <p class="docs-lead">
              Note that sQuery.getresulttemplateurl is first called above to retrieve the template URL, which is then passed into
              the sQuery.getlocationdescriptor method as a parameter to retrieve the template XML.  The template XML is itself 
              returned to the anonymous callback parameter "t".
              </p>
              <p class="docs-lead">
              With the result template in hand we can extract the template details, which in this case, are the location details 
              supplied by the SOS server for our fake GPS server.  And, how do we do this?  Yes, using another sQuery extension/plug-in
              called sQuery.getlocationdetails.  This method accepts the template [t] as a parameter and returns the contents
              as an Object.
              </p>

<pre class="prettyprint linenums">
var mikesServer = "http://bottsgeo.com:8181/sensorhub";
var alexsServer = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub";
try { 
  var url = S(mikesServer).getresulttemplateurl('&lt;identifier&gt;', '&lt;observed property&gt;');
  S().getlocationdescriptor(url, function(t) {
    var $locDetails = S().getlocationdetails(t);
    console.log($locDetails);
  });
} catch (e) {
  console.log(e);
}</pre>

          <p class="docs-lead">
          The Object returned by getlocationdetails contains four attributes -- coordinatesystem, decimalsepartor, tokenseparator and tokens.
          Tokens are the actual data records returned by the SOS server [and we will learn how to get them in the next section below], and 
          tokenseparator defines how they are separated [as in separated by comma, or pipe, or other].  The coordinate system is the 
          coordinate space of the data that is returned and is also trickled as a property of each token.  Decimalseperator simply defines
          the character that separates the decimals; typically '.'.  The tokens, which are returned as an array, are also returned in 
          the same order as the in-coming data.
          </p>
          <div class="alert alert-info">
            <span class="icon-info-sign"></span> For the sake of this exercise we will restrict gathering location details from a specific template!
            The URL for this tempate is: http://bottsgeo.com:8181/sensorhub/sos?service=SOS&version=2.0&request=GetResultTemplate&offering=urn:android:device:FA44CWM03715-sos&observedProperty=http://sensorml.com/ont/swe/property/Location
          </div>              
          <h2>sQuery.getlocationdetails In Action</h2>
  
          <button id="btnGetLocationTemplate" class="ui-button-primary">Get Location Template Details</button>

          <div id="gldTabs">
              <ul>
                  <li><a href="#gldTabs-Demo">Demo</a></li>
                  <li><a href="#gldTabs-Code">Code</a></li>
              </ul>
              <div id="gldTabs-Demo">
                <p class="docs-lead">
                  <label for="gldURL">Fake GPS Template URL: </label>
                  <input type="text" id="gldURL" class="serviceident" value="http://bottsgeo.com:8181/sensorhub/sos?service=SOS&version=2.0&request=GetResultTemplate&offering=urn:android:device:FA44CWM03715-sos&observedProperty=http://sensorml.com/ont/swe/property/Location">
                </p>
                <p class="docs-lead">
                  <label for="gldTokenSeparator">Token Separator: </label>
                  <input type="text" id="gldTokenSeparator" class="serviceident">
                  <label for="gldDecimalSeparator">Decimal Separator: </label>
                  <input type="text" id="gldDecimalSeparator" class="serviceident">
                  <label for="gldCS">Coordinate System: </label>
                  <input type="text" id="gldCS" class="serviceident">
                  <label for="gldTokens">Tokens: </label>
                  <select id="gldTokens" class="serviceident"></select>
                  <label for="gldTokenZone">Token Zone (applies only for time): </label>
                  <input type="text" id="gldTokenZone" class="serviceident">
                  <label for="gldTokenUOM">Token Unit of Measure: </label>
                  <input type="text" id="gldTokenUOM" class="serviceident">
                  <label for="gldTokenCS">Token Coordinate System: </label>
                  <input type="text" id="gldTokenCS" class="serviceident">
                  <label for="gldTokenDefinition">Token Definition: </label>
                  <input type="text" id="gldTokenDefinition" class="serviceident">
                </p>
              </div>
              <div id="gldTabs-Code">
<pre class="prettyprint linenums">
$( "#btnGetLocationTemplate").button().click(function(){
  // The URL is hardcoded for the sake of demonstration. It was produced using the sQuery.getresulttemplateurl() as illustrated in above.
  var url = "http://bottsgeo.com:8181/sensorhub/sos?service=SOS&version=2.0&request=GetResultTemplate&offering=urn:android:device:FA44CWM03715-sos&observedProperty=http://sensorml.com/ont/swe/property/Location";
  S().getlocationdescriptor(url, function(t) {
     $locDetails = S().getlocationdetails(t);
     console.log($locDetails);
     $("#gldTokenSeparator").val($locDetails.tokenseparator);
     $("#gldDecimalSeparator").val($locDetails.decimalseparator);
     $("#gldCS").val($locDetails.coordinatesystem);

    $.each($locDetails.tokens, function( index, token) {
      $("#gldTokens").append("<option value='" + index + "'>" + token.name + "</option>");
    });    
    
    $("#gldTokens").change();
    
  });
});

$( "#gldTokens").change(function() {
  
  if ($("#gldTokens option:selected").text() === "time") {
    $("#gldTokenZone").val($locDetails.tokens[this.value].zone);
    $("#gldTokenCS").val("");
    $("#gldTokenDefinition").val("");      
  } else {
    $("#gldTokenZone").val("");
    $("#gldTokenCS").val($locDetails.tokens[this.value].coordinatesystem);
    $("#gldTokenDefinition").val($locDetails.tokens[this.value].definition);      
  }
  $("#gldTokenUOM").val($locDetails.tokens[this.value].uom);

});</pre>
              </div>
          </div>
              
          </section>
        
          <!-- Results -->
          <section id="results">
              <div class="page-header">
                  <h1>4. Results</h1>
              </div>
              <div class="row-fluid">
                  <p class="docs-lead">
                  We are now ready to get the results (data feed), and using the description of the data via the template, we can
                  interpret the results.  First, how do we retrieve the data?
                  </p>
                  <p class="docs-lead">
                  Data can be retrieved using a GET request via XMLHttp or using a websocket.  It is recommended to use websockets
                  when retrieving live data streams, or when playing back recorded streams, so as to avoid setting up timers and polling
                  intervals.  However, it is better to use XMLHttp GET requests to fetch the data template because it is a small
                  finite schema that describes the data.
                  </p>
                  <p class="docs-lead">
                  The URL for retrieving data is very similar to getting the result template, with two key differences.  The request 
                  parameter must be "GetResult" rather than "GetResultTemplate", and a time filter must be applied.
                  </p>
              </div>
              <div class="alert alert-info">
                <span class="icon-info-sign"></span> The time filter is of the format &lt;starttime&gt;/&lt;endtime&gt;
              </div>              
              <div class="alert alert-info">
                <span class="icon-info-sign"></span> All times must be provided in UTC (http://www.opengis.net/def/trs/BIPM/0/UTC).  
              </div>              
              <div class="row-fluid">
                  <p class="docs-lead">
                  So, how do we know what time range is available for a particular observable on the server?  This is determined by reviewing
                  the offerings of the SOS server as illustrated in the capabilities section above.  The server advertises all the start 
                  and ending times available for a particular offering.  If the observable is feeding live data, then a start time is 
                  set, the end time is empty and indeterminate time will be "Now" indicating that the feed is live.  
                  </p>
                  <p class="docs-lead">
                  Any time range within the stored time range can be requested.  When requesting results for live feeds, the start time of the
                  filter must be set to Now and the end time must be set to some date in the very distant future.
                  </p>
              </div>
              <div class="alert alert-info">
                <span class="icon-info-sign"></span> Following are examples of time formats:<br/>
                1: Now/2020-01-01 <br/>
                2: Now/2100-03-10T20:00:00Z <br/>
                3: 2015-03-07/2015-04-20<br/>
                4: 2015-03-07T08:00:00Z/2015-04-20T13:15:00Z
              </div>              
              <div class="row-fluid">
                <p class="docs-lead">
                There are two sQuery core methods, getresulthttpurl and getresultwsurl, that generate the desired URLs to get results.
                Let see them in action below.
                </p>
              </div>
              <h2>sQuery.getresulthttpurl & sQuery.getresultwsurl in Action</h2>
              <div class="row-fluid">
                  <p class="docs-lead">
                  Select an identifier and an observable, and click the Get Result Template URL button.
                  </p>
              </div>
              <button id="btnGetResultURL" class="ui-button-primary">Get Result URL</button>
          
             <div id="grTabs">
                  <ul>
                      <li><a href="#grTabs-Demo">Demo</a></li>
                      <li><a href="#grTabs-Code">Code</a></li>
                  </ul>
                  <div id="grTabs-Demo">

                    <p class="docs-lead">
                      <select id = "grurloffServers" class="baseurl">
                       <option value = "">Select a SOS Server</option>
                       <option value = "http://bottsgeo.com:8181/sensorhub">Mike's Server [http://bottsgeo.com:8181/sensorhub] </option>
                       <option value = "http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub">Alex's Server [http://ec2-52-16-177-252.eu-west-1.compute.amazonaws.com:8181/sensorhub]</option>
                      </select>
                    </p>
                    <p class="docs-lead">
                      <label for="grtemporalfilter">Time filter: </label>
                      <input type="text" id="grtemporalfilter" placeholder="Now/2020-01-01" class="serviceident">
                      <label for="grurlofferings">Offerings: </label>
                      <select id="grurlofferings" class="serviceident"></select>
                      <label for="grurloffIdentifier">Identifier: </label>
                      <input type="text" id="grurloffIdentifier" class="serviceident">
                      <label for="grurloffObservables">Observables: </label>
                      <select id="grurloffObservables" class="serviceident"></select>
                      <label for="grurlhttpURL">Http URL: </label>
                      <input type="text" id="grurlhttpURL" class="serviceident">
                      <label for="grurlwsURL">Websocket URL: </label>
                      <input type="text" id="grurlwsURL" class="serviceident">
                    </p>                  

                  </div>
                  <div id="grTabs-Code">
<pre class="prettyprint linenums">
$( "#grurloffServers").change(function() {
  if (this.value === "")  {
    $("#grurloffIdentifier").val("");
    $("#grurlofferings").empty();
    $("#grurloffObservables").empty();
    $("#grurlhttpURL").val("");
    $("#grurlwsURL").val("");
  } else {
   try {
     S(this.value).getcapabilities(function(c) {
      try {
        $grurlofferings = S().getofferings(c);
        $("#grurlofferings").empty();
        $("#grurloffIdentifier").val("");
        $("#grurloffObservables").empty();
        $("#grurlhttpURL").val("");
        $("#grurlwsURL").val("");

        $("#grurlofferings").append("<option value=''>Select an Offering</option>");
        $.each($grurlofferings, function( index, offering) {
          $("#grurlofferings").append("<option value='" + index + "'>" + offering.name + "</option>");
        });    

      } catch (e) {
        console.log(e);
      }
     });
   } catch (e) {
     alert(e);
   }
  }
});

$( "#grurlofferings").change(function() {
  if (this.value === "")  {
    $("#grurloffIdentifier").val("");
    $("#grurloffObservables").empty();
    $("#grurlhttpURL").val("");
    $("#grurlwsURL").val("");
  } else {
    try {
      $("#grurloffIdentifier").val($grurlofferings[parseInt(this.value)].identifier);
      $("#grurloffObservables").empty();
      $("#grurlhttpURL").val("");
      $("#grurlwsURL").val("");
      $.each($grurlofferings[parseInt(this.value)].observableproperties, function( index, observableproperty) {
        $("#grurloffObservables").append("<option value='" + index + "'>" + observableproperty + "</option>");
      });
   } catch (e) {
     alert(e);
   }
  }
});

$( "#btnGetResultURL").button().click(function(){
  if (undefined === $("#grurloffIdentifier").val().trim() || !$("#grurloffIdentifier").val().trim()) {
    alert( _("identifier_must_be_set", {"function" : "btnGetResultURL"} ) );
    return;
  }
  if (undefined === $("#grtemporalfilter").val().trim() || !$("#grtemporalfilter").val().trim()) {
    alert( "Time filter must be supplied." );
    return;
  }
  var httpurl = S($("#grurloffServers option:selected").val())
            .getresulthttpurl($("#grurloffIdentifier").val(), 
                              $("#grurloffObservables option:selected").text(),
                              $("#grtemporalfilter").val());
  var wsurl = S($("#grurloffServers option:selected").val())
            .getresultwsurl($("#grurloffIdentifier").val(), 
                            $("#grurloffObservables option:selected").text(),
                            $("#grtemporalfilter").val());
  $("#grurlhttpURL").val(httpurl);
  $("#grurlwsURL").val(wsurl);

});</pre>
                  </div>
              </div>

          </section>
        
        
      </div>
    </div>
  </div>
<!-- Footer -->
<footer class="footer">
  <div class="container">
    <p>
        Open Sensorhub Client Library &copy; 2014 - 2015.
    </p>
    <ul class="footer-links">
        <li><a href="https://github.com/mikebotts/swe-client/tree/master/OpenSensorHubClientLibrary">GitHub</a></li>
        <li class="muted">&middot;</li>
        <li><a href="https://github.com/mikebotts/swe-client">Issues</a></li>
    </ul>
  </div>
</footer>  
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src="assets/js/jquery-ui-1.10.0.custom.min.js" type="text/javascript"></script>
<script src="assets/js/google-code-prettify/prettify.js" type="text/javascript"></script>
<script src="assets/js/docs.js" type="text/javascript"></script>
<script src="assets/js/demo.js" type="text/javascript"></script>
</body>
</html>
